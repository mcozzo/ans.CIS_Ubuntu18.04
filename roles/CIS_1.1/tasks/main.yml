---
# This playbook contains Ubuntu 18.04LTS CIS benchmark v1.0.0 settings

- name: 1.1.1.1 - Disable cramfs
  lineinfile:
    path: /etc/modprobe.d/cramfs.conf
    regexp: 'install cramfs /bin/true'
    line: "install cramfs /bin/true"
    state: present
    backup: yes
    create: yes
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.1 - unload cramfs
  modprobe:
    name: cramfs
    state: absent
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.2 - Disable freevxfs
  lineinfile:
    path: /etc/modprobe.d/freevxfs.conf
    regexp: 'install freevxfs /bin/true'
    line: "install freevxfs /bin/true"
    state: present
    backup: yes
    create: yes
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.2 - unload freevxfs
  modprobe:
    name: freevxfs
    state: absent
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.3 - Disable jffs2
  lineinfile:
    path: /etc/modprobe.d/jffs2.conf
    regexp: 'install jffs2 /bin/true'
    line: "install jffs2 /bin/true"
    state: present
    backup: yes
    create: yes
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.3 - unload jffs2
  modprobe:
    name: jffs2
    state: absent
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.4 - Disable hfs
  lineinfile:
    path: /etc/modprobe.d/hfs.conf
    regexp: 'install hfs /bin/true'
    line: "install hfs /bin/true"
    state: present
    backup: yes
    create: yes
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.4 - unload hfs
  modprobe:
    name: hfs
    state: absent
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.5 - Disable hfsplus
  lineinfile:
    path: /etc/modprobe.d/hfsplus.conf
    regexp: 'install hfsplus /bin/true'
    line: "install hfsplus /bin/true"
    state: present
    backup: yes
    create: yes
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.5 - unload hfsplus
  modprobe:
    name: hfsplus
    state: absent
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.6 - Disable udf
  lineinfile:
    path: /etc/modprobe.d/udf.conf
    regexp: 'install udf /bin/true'
    line: "install udf /bin/true"
    state: present
    backup: yes
    create: yes
  tags:
    - filesystem
  notify:
    - Reboot host

- name: 1.1.1.6 - unload udf
  modprobe:
    name: udf
    state: absent
  tags:
    - filesystem
  notify:
    - Reboot host

# Unceremoniously rip /tmp config from fstab
- name: 1.1.2 - No /tmp directory in /etc/fstab
  lineinfile:
    path: /etc/fstab
    regexp: '/tmp'
    state: absent
    backup: yes
    create: no
  tags:
    - filesystem
  notify:
    - Reboot host

# 1.1.3 nodev option set on /tmp in /etc/fstab
# 1.1.4 nosuid option set on /tmp in /etc/fstab
# no need, because we arn't allowing /tmp to exist

# Unceremoniously rip /var config from fstab
- name: 1.1.5 & 1.1.6 - No /var directory in /etc/fstab
  lineinfile:
    path: /etc/fstab
    regexp: '/var'
    state: absent
    backup: yes
    create: no
  tags:
    - filesystem
  notify:
    - Reboot host

# 1.1.7 nodev option set on /tmp in /etc/fstab
# 1.1.8 nosuid option set on /tmp in /etc/fstab
# no need, because we arn't allowing /tmp to exist

# Unceremoniously rip /var config from fstab
- name: 1.1.10 & 1.1.11 - No /var/log directory in /etc/fstab
  lineinfile:
    path: /etc/fstab
    regexp: '/var'
    state: absent
    backup: yes
    create: no
  tags:
    - filesystem
  notify:
    - Reboot host

# 1.1.12 Separate partition for /home Need a solution
#- name: 1.1.12  - No /var/log directory in /etc/fstab
#  lineinfile:
#    path: /etc/fstab
#    regexp: '/var'
#    state: absent
#    backup: yes
#    create: no
#  notify:
#    - Reboot host

# Actually all of the 1.1.X file system level stuff needs to be addressed on a per host basis

- name: 1.1.21 - Un-install autofs (Automount of devices)
  apt:
    name: autofs
    state: absent
#    update_cache: yes
  tags:
    - filesystem
  notify:
    - Reboot host

#- name: 1.1.2.1 - Disable autofs (Automount of devices)
#  systemd:
#    name: autofs
#    enabled: no
#    state: stopped
#  notify:
#    - Reboot host
#  tags:
#    - filesystem



